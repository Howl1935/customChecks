# Deploy clusters using T3 instances or non-burstable instance types for production workloads
# Notes: Confirm that these instances are the correct ones to avoid and there aren't others.  Also, can we define production workloads?

# reference:
# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster
# https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/supported-engine-versions.html

# checkov custom policy reference:
# https://www.checkov.io/3.Custom%20Policies/YAML%20Custom%20Policies.html
# https://www.checkov.io/3.Custom%20Policies/Examples.html


---
metadata:
 name: "Come back and fix this."
 id: "CKV_IBT_001"
 category: "BACKUP_AND_RECOVERY"
definition:
  and:
    - cond_type: "filter"
      value:
      - "aws_dax_cluster"
      attribute: "resource_type"
      operator: "within"
    - cond_type: "attribute"
      resource_types: 
      - "aws_dax_cluster"
      attribute: "subnet_group_name"
      operator: "exists"
    - cond_type: "attribute"
      resource_types:
      - "aws_dax_cluster"
      attribute: "subnet_group_name"
      operator: "contains"
      value: "aws_dax_subnet_group"
    - cond_type: "connection"
      resource_types:
      - "aws_dax_cluster"
      connected_resource_types:
      - "aws_dax_subnet_group"
      operator: "exists"  
    - cond_type: "attribute"
      resource_types:
      - "aws_dax_subnet_group"
      attribute: "subnet_ids"
      operator: "exists"

 
          



    

